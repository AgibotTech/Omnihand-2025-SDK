<?xml version="1.0"?>

<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

    <xacro:macro name="finger" params="prefix mesh_path">

        <link name="${prefix}_abad">
            <visual>
                <origin rpy="0 0 0" xyz="0 0 0" />
                <geometry>
                    <mesh filename="${mesh_path}/finger_abad.STL" />
                </geometry>
                <material name="green" />
            </visual>
            <inertial>
                <origin rpy="0 0 0"
                    xyz="${finger_abad_com_x} ${finger_abad_com_y} ${finger_abad_com_z}" />
                <mass value="${finger_abad_mass}" />
                <inertia
                    ixx="${finger_abad_ixx}" ixy="${finger_abad_ixy}" ixz="${finger_abad_ixz}"
                    iyy="${finger_abad_iyy}" iyz="${finger_abad_iyz}" izz="${finger_abad_izz}" />
            </inertial>
        </link>
        y <joint name="${prefix}_pip_joint" type="revolute">
            <origin xyz="${finger_pip_x} ${finger_pip_y} ${finger_pip_z}" rpy="0 0 0" />
            <parent link="${prefix}_abad" />
            <child link="${prefix}_pip" />
            <axis xyz="0 1 0" />
            <limit effort="${finger_pip_torque_max}" velocity="${finger_pip_velocity_max}"
                lower="${finger_pip_position_min}" upper="${finger_pip_position_max}" />
        </joint>

        <link
            name="${prefix}_pip">
            <visual>
                <origin rpy="0 0 0" xyz="0 0 0" />
                <geometry>
                    <mesh filename="${mesh_path}/finger_pip.STL" />
                </geometry>
                <material name="brown" />
            </visual>
            <collision>
                <origin rpy="0 0 0" xyz="0 0 ${finger_pip_collision_z}" />
                <geometry>
                    <cylinder radius="${finger_pip_collision_r}" length="${finger_pip_collision_l}" />
                </geometry>
            </collision>
            <inertial>
                <origin rpy="0 0 0"
                    xyz="${finger_pip_com_x} ${finger_pip_com_y} ${finger_pip_com_z}" />
                <mass value="${finger_pip_mass}" />
                <inertia
                    ixx="${finger_pip_ixx}" ixy="${finger_pip_ixy}"
                    ixz="${finger_pip_ixz}"
                    iyy="${finger_pip_iyy}" iyz="${finger_pip_iyz}"
                    izz="${finger_pip_izz}" />
            </inertial>
        </link>

        <joint
            name="${prefix}_dip_joint" type="revolute">
            <origin xyz=" ${finger_dip_x}  ${finger_dip_y} ${finger_dip_z}" rpy="0 0 0" />
            <parent link="${prefix}_pip" />
            <child link="${prefix}_dip" />
            <axis xyz="0 1 0" />
            <limit effort="${finger_dip_torque_max}" velocity="${finger_dip_velocity_max}"
                lower="${finger_dip_position_min}" upper="${finger_dip_position_max}" />
            <mimic
                joint="${prefix}_pip_joint"
                multiplier="${finger_dip_multiplier}"
                offset="0" />
        </joint>

        <link name="${prefix}_dip">
            <visual>
                <origin rpy="0 0 0" xyz="0 0 0" />
                <geometry>
                    <mesh filename="${mesh_path}/finger_dip.STL" />
                </geometry>
                <material name="orange" />
            </visual>
            <collision>
                <origin rpy="0 0 0" xyz="0 0 ${finger_dip_collision_z}" />
                <geometry>
                    <cylinder radius="${finger_dip_collision_r}" length="${finger_dip_collision_l}" />
                </geometry>
            </collision>
            <inertial>
                <origin rpy="0 0 0"
                    xyz="${finger_dip_com_x} ${finger_dip_com_y} ${finger_dip_com_z}" />
                <mass value="${finger_dip_mass}" />
                <inertia
                    ixx="${finger_dip_ixx}" ixy="${finger_dip_ixy}" ixz="${finger_dip_ixz}"
                    iyy="${finger_dip_iyy}" iyz="${finger_dip_iyz}" izz="${finger_dip_izz}" />
            </inertial>
        </link>

        <joint
            name="${prefix}_tip_joint" type="fixed">
            <origin xyz="${finger_tip_x} 0 ${finger_tip_z}" rpy="0 0 0" />
            <parent link="${prefix}_dip" />
            <child link="${prefix}_tip" />
        </joint>
        <link name="${prefix}_tip">
            <visual>
                <origin rpy="0 0 0" xyz="0 0 0" />
                <geometry>
                    <sphere radius="1e-3" />
                </geometry>
                <material name="white" />
            </visual>
        </link>
    </xacro:macro>
</robot>